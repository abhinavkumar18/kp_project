select 
case_followup_id, ac.case_id, acm.cmb_dtl_id followup_status_code,
acm.cmb_dtl_name followup_status_name, f.crt_dt,  ap.patient_id, ap.ration_card_no, 
ap.resident_id, ap.first_name patient_name, -- ap.aadhar_no, 
(select distinct UID_NO from(
        SELECT  UID_NO FROM ASRIT_JANMABHOOMI_FAMILY  WHERE RESIDENT_ID = AP.RESIDENT_ID  and active_yn = 'Y'
        UNION ALL
        SELECT  UID_NO FROM ASRIT_TAP_FAMILY_AP WHERE RESIDENT_ID = AP.RESIDENT_ID   and active_yn = 'Y'
        UNION ALL 
        SELECT  UID_NO FROM ASRIT_FAMILY_CS_AP WHERE RESIDENT_ID = AP.RESIDENT_ID  and active_yn = 'Y'

    ) WHERE ROWNUM = 1
    ) AADHAR_NO

from asrit_case_followup_claim f
left join asrit_case ac on ac.case_id = f.case_id
left join asrit_patient ap on ap.patient_id = ac.case_patient_no
left join asrim_combo acm on acm.cmb_dtl_id = f.payment_status
where f.payment_status = 'CD412'
and to_date(f.crt_dt) = to_date(sysdate) - 1
order by f.crt_dt desc

spring.mail.host=10.10.223.151
spring.mail.port=25
spring.mail.username=biometricissues@ysraarogyasri.ap.gov.in
spring.mail.password=Password@123
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true

Password@1123

SELECT dcf.merged_request_number,dcf.admin_sanction_number,
SUM(dcp.amount) AS total_sanctioned_amount,dcf.remarks AS overall_remarks,
STRING_AGG('(' || COALESCE(dcpm.particular_description, dcp.particular_name) || ' : ' || dcp.amount || ')', ', ') AS particular_wise_amount,
stm.case_status_name AS case_StatusName,
dm.district_name AS district_Name,dcf.year_raised_for AS raised_Year,gtm.type_name AS raised_Month,dcf.crt_on AS raised_On
FROM ysr.ysr_dc_forms dcf
LEFT JOIN ysr.ysr_dc_forms_pariculars_list dcp ON dcp.form_id = dcf.form_id
LEFT JOIN ysr.ysr_dc_forms_particulars_mst dcpm ON dcpm.particular_id = dcp.particular_id
LEFT JOIN ysr.ysr_step_role_mapping stm ON stm.step_role_id = dcf.status
LEFT JOIN ysr.ysr_user_district_mapping udm ON udm.user_id = dcf.crt_by
LEFT JOIN ysr.ysr_district_mst dm ON dm.dist_id = udm.district_id
LEFT JOIN ysr.ysr_general_type_mst gtm ON gtm.type_id = dcf.month_raised_for
WHERE dcf.status = 274 and dcf.merged_request_number = 'DC_MER/2024/0000026'
GROUP BY dcf.merged_request_number,dcf.admin_sanction_number, dcf.remarks,stm.case_status_name, dm.district_name, dcf.year_raised_for,gtm.type_name, dcf.crt_on
ORDER BY dcf.admin_sanction_number;


SELECT 
    dm.district_name AS District,
    SUM(dcp.amount) AS total_amount_raised,
    COUNT(CASE WHEN dcf.form_type= '1' THEN 1 END) AS no_of_office_expense_form_submitted,
    COUNT(CASE WHEN dcf.form_type= '2' THEN 1 END) AS no_of_hired_travel_expense_form_submitted
FROM ysr.ysr_dc_forms dcf
LEFT JOIN ysr.ysr_dc_forms_pariculars_list dcp ON dcp.form_id = dcf.form_id
LEFT JOIN ysr.ysr_dc_forms_particulars_mst dcpm ON dcpm.particular_id = dcp.particular_id
LEFT JOIN ysr.ysr_user_district_mapping udm ON udm.user_id = dcf.crt_by
LEFT JOIN ysr.ysr_district_mst dm ON dm.dist_id = udm.district_id
WHERE dcf.status = 274
GROUP BY dm.district_name
ORDER BY dm.district_name;
*******************************************
-- For count api :

-- Medco : (initiated request count, approved request count, rejected request count)

-- MO: (initiated request count, approved request count,request dispatched, request delivered)

-- PH:(initiated request count, approved request count,request dispatched, request delivered, request pending at me )

-- CEO:(same as MO)
 
--Medco initiated count

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status = 1 or mra.status = 1

and crt_by = ;
 
--Medco approved count

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status = 3 or mra.status = 3

and crt_by = ;
 
--Medical Officer

-- Tiles in MO login - Request initiated , 

-- Request approved by Medical officer , 

-- Request dispatched by vendor to pharmacist ,  

-- Request  dispatched to beneficiary , Request delivered.
 
-- Request initiated

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status in (1,2) or mra.status in (1,2)

-- and crt_by = 

;
 
-- Request approved by Medical officer

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status in (3,5) or mra.status in (3,5)

and upd_by = 

;
 
-- Request dispatched by vendor to pharmacist , 

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status in (7,8) or mra.status in (7,8)

-- and upd_by = 

;
 
-- Request  dispatched to beneficiary

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status in (15,16) or mra.status in (15,16)

-- and upd_by = 

;
 
-- Request delivered

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status in (17,18) or mra.status in (17,18)

-- and upd_by = 

;
 
-- Dashboard tiles in Vendor login : 

-- Requests Raised,Requests Dispatched, 

-- Requests Delivered.
 
-- Requests Raised

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status in (3,5) or mra.status in (3,5)

-- and upd_by = 

;
 
-- Requests Dispatched,

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status in (15,16) or mra.status in (15,16)

-- and upd_by = 

;
 
-- Requests Delivered.

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status in (17,18) or mra.status in (17,18)

-- and upd_by = 

;
 
-- Pharmacist

-- Request initiated , Request approved by Medical officer, 

-- Requests pending with Vendor , 

-- Request dispatched by vendor to pharmacist ,  

-- Request  dispatched to beneficiary , Request delivered.
 
-- Request initiated

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status = 2 or mra.status = 2

and crt_by = ;
 
-- Request approved by Medical officer

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status = 5 or mra.status = 5

and crt_by = ;
 
-- Request dispatched by vendor to pharmacist

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status in (7,8) or mra.status in (7,8)

-- and upd_by = 

;
 
-- Requests Dispatched to beneficiary,

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status in (15,16) or mra.status in (15,16)

-- and upd_by = 

;
 
-- Requests Delivered.

select count(*) from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number

where 1=1 and mr.status in (17,18) or mra.status in (17,18)

-- and upd_by = 

;
 
-- 2. Api for the inbox table where userid will be a mandatory input and the filters will be request no. , status , created on

-- (Fetched data needed : request no. , empId, empName, raised on , current status )
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,

mr.crt_on raised_on,

sr.case_status_name current_status

from medical.md_beneficiary_request_details mr

left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id

left join medical.md_step_role_mapping sr on sr.step_role_id = mr.status

where crt_by =

 *************************************
--Audit history
 
select * from (
select (select  distinct yrm.role_name	from medical.md_step_flow_mapping asfm, 
			medical.md_step_role_mapping asrm1, medical.md_role_mst yrm where yrm.role_id = asrm1.role_id  
			and  asfm.next_step_role_id  = dc.status
			and asfm.initial_step_role_id = asrm1.step_role_id
			group by asfm.initial_step_role_id, yrm.role_name
			 )
				 || ' , ' || user_name roleAndName,coalesce(dc.upd_on,dc.crt_on) dateTime,sm.case_status_name,dc.remarks
from medical.md_beneficiary_request_details dc
left join medical.md_user_mst yum on yum.user_id = coalesce(dc.upd_by,dc.crt_by)
left join medical.md_step_role_mapping sm on sm.step_role_id = dc.status
where dc.request_number = 
union all 
select (select  distinct yrm.role_name	from medical.md_step_flow_mapping asfm, 
			medical.md_step_role_mapping asrm1, medical.md_role_mst yrm where yrm.role_id = asrm1.role_id  
			and  asfm.next_step_role_id  = dc.status
			and asfm.initial_step_role_id = asrm1.step_role_id
			group by asfm.initial_step_role_id, yrm.role_name
			 )
				 || ' , ' || user_name roleAndName,coalesce(dc.upd_on,dc.crt_on) dateTime,sm.case_status_name,dc.remarks
from medical.md_beneficiary_request_details_audit dc
left join medical.md_user_mst yum on yum.user_id = coalesce(dc.upd_by,dc.crt_by)
left join medical.md_step_role_mapping sm on sm.step_role_id = dc.status
where dc.request_number = ) as b
order by b.dateTime
 
-- All data
 
select mr.request_number,md.drug_name,gm.type_name drug_type,md.quantity,md.remarks,
md.batch_no,md.manufactured_date,md.expiry_date,md.mrp,md.gst_slab
mr.crt_on raised_on,sm.case_status_name
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_drug_details md on md.request_number = mr.request_number
left join medical.md_general_type_mst gm on gm.type_id = md.drug_type
left join medical.md_step_role_mapping sm on sm.step_role_id = mr.status
********************************************************************************************
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mr.crt_on raised_on,sr.case_status_name current_status
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_step_role_mapping sr on sr.step_role_id = mr.status
-- join medical.md_user_mst um on um.user_id = mr.crt_by
join medical.md_step_mst sm on sm.step_id = sr.step_id and sm.workflow_id = '1' 
-- join medical.md_role_mst rm on rm.role_id = srm.role_id
where sr.role_id =
*****************************************************************************************************
Indent Request Id, Employee Id, User Name, Mobile Number, District, Raised Date
 
--Medco initiated count
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status = 1 or mra.status = 1
and crt_by = ;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status = 1 or mra.status = 1
and crt_by = ;
 
--Medco approved count
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status = 3 or mra.status = 3
and crt_by = ;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status = 3 or mra.status = 3
and crt_by = ;
 
--Medical Officer
-- Tiles in MO login - Request initiated , 
-- Request approved by Medical officer , 
-- Request dispatched by vendor to pharmacist ,  
-- Request  dispatched to beneficiary , Request delivered.
 
-- Request initiated
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status in (1,2) or mra.status in (1,2)
-- and crt_by = 
;
 
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status in (1,2) or mra.status in (1,2)
-- and crt_by = 
;
 
 
-- Request approved by Medical officer
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status in (3,5) or mra.status in (3,5)
and upd_by = 
;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status in (3,5) or mra.status in (3,5)
and upd_by = 
;
 
-- Request dispatched by vendor to pharmacist , 
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status in (7,8) or mra.status in (7,8)
-- and upd_by = 
;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status in (7,8) or mra.status in (7,8)
-- and upd_by = 
;
 
-- Request  dispatched to beneficiary
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status in (15,16) or mra.status in (15,16)
-- and upd_by = 
;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status in (15,16) or mra.status in (15,16)
-- and upd_by = 
;
 
-- Request delivered
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status in (17,18) or mra.status in (17,18)
-- and upd_by = 
;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status in (17,18) or mra.status in (17,18)
-- and upd_by = 
;
 
-- Dashboard tiles in Vendor login : 
-- Requests Raised,Requests Dispatched, 
-- Requests Delivered.
 
-- Requests Raised
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status in (3,5) or mra.status in (3,5)
-- and upd_by = 
;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status in (3,5) or mra.status in (3,5)
-- and upd_by = 
;
 
-- Requests Dispatched,
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status in (15,16) or mra.status in (15,16)
-- and upd_by = 
;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status in (15,16) or mra.status in (15,16)
-- and upd_by = 
;
 
-- Requests Delivered.
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status in (17,18) or mra.status in (17,18)
-- and upd_by = 
;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status in (17,18) or mra.status in (17,18)
-- and upd_by = 
;
 
 
-- Pharmacist
-- Request initiated , Request approved by Medical officer, 
-- Requests pending with Vendor , 
-- Request dispatched by vendor to pharmacist ,  
-- Request  dispatched to beneficiary , Request delivered.
 
-- Request initiated
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status = 2 or mra.status = 2
and crt_by = ;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status = 2 or mra.status = 2
and crt_by = ;
 
-- Request approved by Medical officer
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status = 5 or mra.status = 5
and crt_by = ;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status = 5 or mra.status = 5
and crt_by = ;
 
-- Request dispatched by vendor to pharmacist
 
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status in (7,8) or mra.status in (7,8)
-- and upd_by = 
;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status in (7,8) or mra.status in (7,8)
-- and upd_by = 
;
 
-- Requests Dispatched to beneficiary,
 
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status in (15,16) or mra.status in (15,16)
-- and upd_by = 
;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status in (15,16) or mra.status in (15,16)
-- and upd_by = 
;
 
-- Requests Delivered.
 
select count(*) from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
where 1=1 and mr.status in (17,18) or mra.status in (17,18)
-- and upd_by = 
;
 
select mr.request_number,mb.beneficiary_id,mb.beneficiary_name,
mb.beneficiary_phone_no,dm.district_name,mr.crt_on
from medical.md_beneficiary_request_details mr
left join medical.md_beneficiary_mst mb on mb.id = mr.beneficiary_id
left join medical.md_beneficiary_request_details_audit mra on mr.request_number = mra.request_number
left join medical.md_district_mst dm on dm.id = mb.district_id
where 1=1 and mr.status in (17,18) or mra.status in (17,18)
-- and upd_by = 
;
********************************************************************************************
SELECT mr.request_number,COALESCE(mb.beneficiary_id, parent_mb.beneficiary_id) AS beneficiary_id,
mb.beneficiary_name AS beneficiary_name,mr.crt_on AS raised_on,
mg.type_name AS relation,sr.case_status_name AS current_status
FROM medical.md_beneficiary_request_details mr
LEFT JOIN medical.md_beneficiary_mst mb ON mb.id = mr.beneficiary_id
LEFT JOIN medical.md_beneficiary_mst parent_mb ON parent_mb.id = mb.parent_benficiary_id
LEFT JOIN medical.md_general_type_mst mg ON mg.type_id = COALESCE(mb.relation, parent_mb.relation)
LEFT JOIN medical.md_step_role_mapping sr ON sr.step_role_id = mr.status
JOIN medical.md_step_mst sm ON sm.step_id = sr.step_id AND sm.workflow_id = '1'
WHERE sr.role_id = ;
*****************************************************************************************************
{ 

    "requestNumber":"MD/2024/8/0000036", 

    "actionId": 1, 

    "userId": 581, 

    "remarks": "Acknowledging", 

    "drugList":[ 

        { 

            "drugId": 81, 

            "drugName": "Rantac", 

            "noOfTablets": 80, 

            "drugType": 21, 

            "drugTypeName": "Tonic", 

            "status": 1, 

            "batchNo": "A-C", 

            "manufacturedDate": "08/03/2024", 

            "expiryDate": "10/10/2030", 

            "mrp": 9800, 

            "gstSlab": "LOW", 

            "isShipped": true, 

            "isAcknowledged": true 

        }, 

        { 

            "drugId": 82, 

            "drugName": "PAN-D", 

            "noOfTablets": 67, 

            "drugType": 20, 

            "drugTypeName": "Tablets", 

            "status": 1, 

            "batchNo": "D-G", 

            "manufacturedDate": "14/06/2023", 

            "expiryDate": "15/11/2029", 

            "mrp": 12000, 

            "gstSlab": "MED", 

            "isShipped": true, 

            "isAcknowledged": true 

        }, 

        { 

            "drugId": 83, 

            "drugName": "Paracetamol", 

            "noOfTablets": 67, 

            "drugType": 22, 

            "drugTypeName": "Insulin", 

            "status": 1, 

            "batchNo": "K-X", 

            "manufacturedDate": "15/04/2020", 

            "expiryDate": "12/12/2027", 

            "mrp": 14400, 

            "gstSlab": "HIG", 

            "isShipped": null, 

            "isAcknowledged": null 

        } 

    ], 

    "dispatchDrugs":null 

} 
